const me=0,Re=8,Ee=20;const Oe=44;class I{static read_bytes(e,r){const s=new I;return s.buf=e.getUint32(r,!0),s.buf_len=e.getUint32(r+4,!0),s}static read_bytes_array(e,r,s){const i=[];for(let t=0;t<s;t++)i.push(I.read_bytes(e,r+8*t));return i}}class U{static read_bytes(e,r){const s=new U;return s.buf=e.getUint32(r,!0),s.buf_len=e.getUint32(r+4,!0),s}static read_bytes_array(e,r,s){const i=[];for(let t=0;t<s;t++)i.push(U.read_bytes(e,r+8*t));return i}}const se=0,ie=1,Y=2,M=2,S=3,$=4;class oe{head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(e,r){e.setBigUint64(r,this.d_next,!0),e.setBigUint64(r+8,this.d_ino,!0),e.setUint32(r+16,this.dir_name.length,!0),e.setUint8(r+20,this.d_type)}write_name_bytes(e,r,s){e.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,s)),r)}constructor(e,r,s){this.d_ino=1n;const i=new TextEncoder().encode(r);this.d_next=e,this.d_namlen=i.byteLength,this.d_type=s,this.dir_name=i}}const ae=1;class B{write_bytes(e,r){e.setUint8(r,this.fs_filetype),e.setUint16(r+2,this.fs_flags,!0),e.setBigUint64(r+8,this.fs_rights_base,!0),e.setBigUint64(r+16,this.fs_rights_inherited,!0)}constructor(e,r){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=e,this.fs_flags=r}}const F=1,x=2,G=4,z=8;class P{write_bytes(e,r){e.setBigUint64(r,this.dev,!0),e.setBigUint64(r+8,this.ino,!0),e.setUint8(r+16,this.filetype),e.setBigUint64(r+24,this.nlink,!0),e.setBigUint64(r+32,this.size,!0),e.setBigUint64(r+38,this.atim,!0),e.setBigUint64(r+46,this.mtim,!0),e.setBigUint64(r+52,this.ctim,!0)}constructor(e,r){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=e,this.size=r}}const le=0;class ce{write_bytes(e,r){e.setUint32(r,this.pr_name_len,!0)}constructor(e){this.pr_name_len=e}}class J{static dir(e){const r=new J;return r.tag=le,r.inner=new ce(e),r}write_bytes(e,r){e.setUint32(r,this.tag,!0),this.inner.write_bytes(e,r+4)}}let ue=class{enable(e){this.log=fe(e===void 0?!0:e,this.prefix)}get enabled(){return this.isEnabled}constructor(e){this.isEnabled=e,this.prefix="wasi:",this.enable(e)}};function fe(c,e){return c?console.log.bind(console,"%c%s","color: #265BA0",e):()=>{}}const p=new ue(!1);class q extends Error{constructor(e){super("exit with exit code "+e),this.code=e}}let Ne=class{start(e){this.inst=e;try{return e.exports._start(),0}catch(r){if(r instanceof q)return r.code;throw r}}initialize(e){this.inst=e,e.exports._initialize()}constructor(e,r,s,i={}){this.args=[],this.env=[],this.fds=[],p.enable(i.debug),this.args=e,this.env=r,this.fds=s;const t=this;this.wasiImport={args_sizes_get(n,o){const a=new DataView(t.inst.exports.memory.buffer);a.setUint32(n,t.args.length,!0);let l=0;for(const u of t.args)l+=u.length+1;return a.setUint32(o,l,!0),p.log(a.getUint32(n,!0),a.getUint32(o,!0)),0},args_get(n,o){const a=new DataView(t.inst.exports.memory.buffer),l=new Uint8Array(t.inst.exports.memory.buffer),u=o;for(let f=0;f<t.args.length;f++){a.setUint32(n,o,!0),n+=4;const h=new TextEncoder().encode(t.args[f]);l.set(h,o),a.setUint8(o+h.length,0),o+=h.length+1}return p.enabled&&p.log(new TextDecoder("utf-8").decode(l.slice(u,o))),0},environ_sizes_get(n,o){const a=new DataView(t.inst.exports.memory.buffer);a.setUint32(n,t.env.length,!0);let l=0;for(const u of t.env)l+=u.length+1;return a.setUint32(o,l,!0),p.log(a.getUint32(n,!0),a.getUint32(o,!0)),0},environ_get(n,o){const a=new DataView(t.inst.exports.memory.buffer),l=new Uint8Array(t.inst.exports.memory.buffer),u=o;for(let f=0;f<t.env.length;f++){a.setUint32(n,o,!0),n+=4;const h=new TextEncoder().encode(t.env[f]);l.set(h,o),a.setUint8(o+h.length,0),o+=h.length+1}return p.enabled&&p.log(new TextDecoder("utf-8").decode(l.slice(u,o))),0},clock_res_get(n,o){let a;switch(n){case 1:{a=5000n;break}case 0:{a=1000000n;break}default:return 52}return new DataView(t.inst.exports.memory.buffer).setBigUint64(o,a,!0),0},clock_time_get(n,o,a){const l=new DataView(t.inst.exports.memory.buffer);if(n===0)l.setBigUint64(a,BigInt(new Date().getTime())*1000000n,!0);else if(n==1){let u;try{u=BigInt(Math.round(performance.now()*1e6))}catch{u=0n}l.setBigUint64(a,u,!0)}else l.setBigUint64(a,0n,!0);return 0},fd_advise(n,o,a,l){return t.fds[n]!=null?t.fds[n].fd_advise(o,a,l):8},fd_allocate(n,o,a){return t.fds[n]!=null?t.fds[n].fd_allocate(o,a):8},fd_close(n){if(t.fds[n]!=null){const o=t.fds[n].fd_close();return t.fds[n]=void 0,o}else return 8},fd_datasync(n){return t.fds[n]!=null?t.fds[n].fd_datasync():8},fd_fdstat_get(n,o){if(t.fds[n]!=null){const{ret:a,fdstat:l}=t.fds[n].fd_fdstat_get();return l!=null&&l.write_bytes(new DataView(t.inst.exports.memory.buffer),o),a}else return 8},fd_fdstat_set_flags(n,o){return t.fds[n]!=null?t.fds[n].fd_fdstat_set_flags(o):8},fd_fdstat_set_rights(n,o,a){return t.fds[n]!=null?t.fds[n].fd_fdstat_set_rights(o,a):8},fd_filestat_get(n,o){if(t.fds[n]!=null){const{ret:a,filestat:l}=t.fds[n].fd_filestat_get();return l!=null&&l.write_bytes(new DataView(t.inst.exports.memory.buffer),o),a}else return 8},fd_filestat_set_size(n,o){return t.fds[n]!=null?t.fds[n].fd_filestat_set_size(o):8},fd_filestat_set_times(n,o,a,l){return t.fds[n]!=null?t.fds[n].fd_filestat_set_times(o,a,l):8},fd_pread(n,o,a,l,u){const f=new DataView(t.inst.exports.memory.buffer),h=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const d=I.read_bytes_array(f,o,a),{ret:b,nread:g}=t.fds[n].fd_pread(h,d,l);return f.setUint32(u,g,!0),b}else return 8},fd_prestat_get(n,o){const a=new DataView(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const{ret:l,prestat:u}=t.fds[n].fd_prestat_get();return u!=null&&u.write_bytes(a,o),l}else return 8},fd_prestat_dir_name(n,o,a){if(t.fds[n]!=null){const{ret:l,prestat_dir_name:u}=t.fds[n].fd_prestat_dir_name();return u!=null&&new Uint8Array(t.inst.exports.memory.buffer).set(u,o),l}else return 8},fd_pwrite(n,o,a,l,u){const f=new DataView(t.inst.exports.memory.buffer),h=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const d=U.read_bytes_array(f,o,a),{ret:b,nwritten:g}=t.fds[n].fd_pwrite(h,d,l);return f.setUint32(u,g,!0),b}else return 8},fd_read(n,o,a,l){const u=new DataView(t.inst.exports.memory.buffer),f=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const h=I.read_bytes_array(u,o,a),{ret:d,nread:b}=t.fds[n].fd_read(f,h);return u.setUint32(l,b,!0),d}else return 8},fd_readdir(n,o,a,l,u){const f=new DataView(t.inst.exports.memory.buffer),h=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){let d=0;for(;;){const{ret:b,dirent:g}=t.fds[n].fd_readdir_single(l);if(b!=0)return f.setUint32(u,d,!0),b;if(g==null)break;if(a-d<g.head_length()){d=a;break}const m=new ArrayBuffer(g.head_length());if(g.write_head_bytes(new DataView(m),0),h.set(new Uint8Array(m).slice(0,Math.min(m.byteLength,a-d)),o),o+=g.head_length(),d+=g.head_length(),a-d<g.name_length()){d=a;break}g.write_name_bytes(h,o,a-d),o+=g.name_length(),d+=g.name_length(),l=g.d_next}return f.setUint32(u,d,!0),0}else return 8},fd_renumber(n,o){if(t.fds[n]!=null&&t.fds[o]!=null){const a=t.fds[o].fd_close();return a!=0?a:(t.fds[o]=t.fds[n],t.fds[n]=void 0,0)}else return 8},fd_seek(n,o,a,l){const u=new DataView(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const{ret:f,offset:h}=t.fds[n].fd_seek(o,a);return u.setBigInt64(l,h,!0),f}else return 8},fd_sync(n){return t.fds[n]!=null?t.fds[n].fd_sync():8},fd_tell(n,o){const a=new DataView(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const{ret:l,offset:u}=t.fds[n].fd_tell();return a.setBigUint64(o,u,!0),l}else return 8},fd_write(n,o,a,l){const u=new DataView(t.inst.exports.memory.buffer),f=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const h=U.read_bytes_array(u,o,a),{ret:d,nwritten:b}=t.fds[n].fd_write(f,h);return u.setUint32(l,b,!0),d}else return 8},path_create_directory(n,o,a){const l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const u=new TextDecoder("utf-8").decode(l.slice(o,o+a));return t.fds[n].path_create_directory(u)}},path_filestat_get(n,o,a,l,u){const f=new DataView(t.inst.exports.memory.buffer),h=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const d=new TextDecoder("utf-8").decode(h.slice(a,a+l)),{ret:b,filestat:g}=t.fds[n].path_filestat_get(o,d);return g!=null&&g.write_bytes(f,u),b}else return 8},path_filestat_set_times(n,o,a,l,u,f,h){const d=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const b=new TextDecoder("utf-8").decode(d.slice(a,a+l));return t.fds[n].path_filestat_set_times(o,b,u,f,h)}else return 8},path_link(n,o,a,l,u,f,h){const d=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null&&t.fds[u]!=null){const b=new TextDecoder("utf-8").decode(d.slice(a,a+l)),g=new TextDecoder("utf-8").decode(d.slice(f,f+h));return t.fds[u].path_link(n,o,b,g)}else return 8},path_open(n,o,a,l,u,f,h,d,b){const g=new DataView(t.inst.exports.memory.buffer),m=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const N=new TextDecoder("utf-8").decode(m.slice(a,a+l));p.log(N);const{ret:L,fd_obj:re}=t.fds[n].path_open(o,N,u,f,h,d);if(L!=0)return L;t.fds.push(re);const ne=t.fds.length-1;return g.setUint32(b,ne,!0),0}else return 8},path_readlink(n,o,a,l,u,f){const h=new DataView(t.inst.exports.memory.buffer),d=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const b=new TextDecoder("utf-8").decode(d.slice(o,o+a));p.log(b);const{ret:g,data:m}=t.fds[n].path_readlink(b);if(m!=null){const N=new TextEncoder().encode(m);if(N.length>u)return h.setUint32(f,0,!0),8;d.set(N,l),h.setUint32(f,N.length,!0)}return g}else return 8},path_remove_directory(n,o,a){const l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const u=new TextDecoder("utf-8").decode(l.slice(o,o+a));return t.fds[n].path_remove_directory(u)}else return 8},path_rename(n,o,a,l,u,f){throw"FIXME what is the best abstraction for this?"},path_symlink(n,o,a,l,u){const f=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[a]!=null){const h=new TextDecoder("utf-8").decode(f.slice(n,n+o)),d=new TextDecoder("utf-8").decode(f.slice(l,l+u));return t.fds[a].path_symlink(h,d)}else return 8},path_unlink_file(n,o,a){const l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){const u=new TextDecoder("utf-8").decode(l.slice(o,o+a));return t.fds[n].path_unlink_file(u)}else return 8},poll_oneoff(n,o,a){throw"async io not supported"},proc_exit(n){throw new q(n)},proc_raise(n){throw"raised signal "+n},sched_yield(){},random_get(n,o){const a=new Uint8Array(t.inst.exports.memory.buffer);for(let l=0;l<o;l++)a[n+l]=Math.random()*256|0},sock_recv(n,o,a){throw"sockets not supported"},sock_send(n,o,a){throw"sockets not supported"},sock_shutdown(n,o){throw"sockets not supported"},sock_accept(n,o){throw"sockets not supported"}}}};class C{fd_advise(e,r,s){return 58}fd_allocate(e,r){return 58}fd_close(){return 0}fd_datasync(){return 58}fd_fdstat_get(){return{ret:58,fdstat:null}}fd_fdstat_set_flags(e){return 58}fd_fdstat_set_rights(e,r){return 58}fd_filestat_get(){return{ret:58,filestat:null}}fd_filestat_set_size(e){return 58}fd_filestat_set_times(e,r,s){return 58}fd_pread(e,r,s){return{ret:58,nread:0}}fd_prestat_get(){return{ret:58,prestat:null}}fd_prestat_dir_name(){return{ret:58,prestat_dir_name:null}}fd_pwrite(e,r,s){return{ret:58,nwritten:0}}fd_read(e,r){return{ret:58,nread:0}}fd_readdir_single(e){return{ret:58,dirent:null}}fd_seek(e,r){return{ret:58,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:58,offset:0n}}fd_write(e,r){return{ret:58,nwritten:0}}path_create_directory(e){return 58}path_filestat_get(e,r){return{ret:58,filestat:null}}path_filestat_set_times(e,r,s,i,t){return 58}path_link(e,r,s,i){return 58}path_open(e,r,s,i,t,n){return{ret:58,fd_obj:null}}path_readlink(e){return{ret:58,data:null}}path_remove_directory(e){return 58}path_rename(e,r,s){return 58}path_symlink(e,r){return 58}path_unlink_file(e){return 58}}class he extends C{fd_fdstat_get(){return{ret:0,fdstat:new B($,0)}}fd_read(e,r){let s=0;for(const i of r)if(this.file_pos<this.file.data.byteLength){const t=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(i.buf_len)));e.set(t,i.buf),this.file_pos+=BigInt(t.length),s+=t.length}else break;return{ret:0,nread:s}}fd_pread(e,r,s){let i=0;for(const t of r)if(s<this.file.data.byteLength){const n=this.file.data.slice(Number(s),Number(s+BigInt(t.buf_len)));e.set(n,t.buf),s+=BigInt(n.length),i+=n.length}else break;return{ret:0,nread:i}}fd_seek(e,r){let s;switch(r){case se:s=e;break;case ie:s=this.file_pos+e;break;case Y:s=BigInt(this.file.data.byteLength)+e;break;default:return{ret:28,offset:0n}}return s<0?{ret:28,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(e,r){let s=0;if(this.file.readonly)return{ret:8,nwritten:s};for(const i of r){const t=e.slice(i.buf,i.buf+i.buf_len);if(this.file_pos+BigInt(t.byteLength)>this.file.size){const n=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(t.byteLength))),this.file.data.set(n)}this.file.data.set(t.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(t.byteLength),s+=i.buf_len}return{ret:0,nwritten:s}}fd_pwrite(e,r,s){let i=0;if(this.file.readonly)return{ret:8,nwritten:i};for(const t of r){const n=e.slice(t.buf,t.buf+t.buf_len);if(s+BigInt(n.byteLength)>this.file.size){const o=this.file.data;this.file.data=new Uint8Array(Number(s+BigInt(n.byteLength))),this.file.data.set(o)}this.file.data.set(n.slice(0,Number(this.file.size-s)),Number(s)),s+=BigInt(n.byteLength),i+=t.buf_len}return{ret:0,nwritten:i}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(e){super(),this.file_pos=0n,this.file=e}}class X extends C{fd_fdstat_get(){return{ret:0,fdstat:new B(S,0)}}fd_readdir_single(e){if(p.enabled&&(p.log("readdir_single",e),p.log(e,Object.keys(this.dir.contents))),p.log(e,Object.keys(this.dir.contents).slice(Number(e))),e>=BigInt(Object.keys(this.dir.contents).length))return{ret:0,dirent:null};const r=Object.keys(this.dir.contents)[Number(e)],s=this.dir.contents[r];return{ret:0,dirent:new oe(e+1n,r,s.stat().filetype)}}path_filestat_get(e,r){const s=this.dir.get_entry_for_path(r);return s==null?{ret:44,filestat:null}:{ret:0,filestat:s.stat()}}path_open(e,r,s,i,t,n){let o=this.dir.get_entry_for_path(r);if(o==null)if((s&F)==F)o=this.dir.create_entry_for_path(r,(s&x)==x);else return{ret:44,fd_obj:null};else if((s&G)==G)return{ret:20,fd_obj:null};if((s&x)==x&&o.stat().filetype!==S)return{ret:54,fd_obj:null};if(o.readonly&&(i&BigInt(64))==BigInt(64))return{ret:63,fd_obj:null};if(!(o instanceof v)&&(s&z)==z){const a=o.truncate();if(a!=0)return{ret:a,fd_obj:null}}return{ret:0,fd_obj:o.open(n)}}path_create_directory(e){return this.path_open(0,e,F|x,0n,0n,0).ret}path_unlink_file(e){e=this.clean_path(e);const r=this.dir.get_parent_dir_for_path(e),s=e.split("/"),i=s[s.length-1],t=this.dir.get_entry_for_path(e);return t===null?44:t.stat().filetype===S?31:(delete r.contents[i],0)}path_remove_directory(e){e=this.clean_path(e);const r=this.dir.get_parent_dir_for_path(e),s=e.split("/"),i=s[s.length-1],t=this.dir.get_entry_for_path(e);return t===null?44:!(t instanceof v)||t.stat().filetype!==S?54:Object.keys(t.contents).length!==0?55:r.contents[i]===void 0?44:(delete r.contents[i],0)}clean_path(e){for(;e.length>0&&e[e.length-1]==="/";)e=e.slice(0,e.length-1);return e}constructor(e){super(),this.dir=e}}class Se extends X{fd_prestat_get(){return{ret:0,prestat:J.dir(this.prestat_name.length)}}fd_prestat_dir_name(){return{ret:0,prestat_dir_name:this.prestat_name}}constructor(e,r){super(new v(r)),this.prestat_name=new TextEncoder().encode(e)}}class de{open(e){const r=new he(this);return e&ae&&r.fd_seek(0n,Y),r}get size(){return BigInt(this.data.byteLength)}stat(){return new P($,this.size)}truncate(){return this.readonly?63:(this.data=new Uint8Array([]),0)}constructor(e,r){this.data=new Uint8Array(e),this.readonly=!!(r!=null&&r.readonly)}}class v{open(e){return new X(this)}stat(){return new P(S,0n)}get_entry_for_path(e){let r=this;for(const s of e.split("/")){if(s=="")break;if(s!="."){if(!(r instanceof v))return null;if(r.contents[s]!=null)r=r.contents[s];else return p.log(s),null}}return r}get_parent_dir_for_path(e){if(e==="")return null;let r=this,s=r;for(const i of e.split("/")){if(i==="")break;if(i!=="."){if(!(r instanceof v))return p.log(r),null;if(r.contents[i]===void 0)return p.log(i),null;s=r,r=r.contents[i]}}return s}create_entry_for_path(e,r){let s=this;const i=e.split("/").filter(t=>t!="/");for(let t=0;t<i.length;t++){const n=i[t];if(!(s instanceof v))break;s.contents[n]!=null||(p.log("create",n),t==i.length-1&&!r?s.contents[n]=new de(new ArrayBuffer(0)):s.contents[n]=new v({})),s=s.contents[n]}return s}constructor(e){this.readonly=!1,this.contents=e}}class Q extends C{fd_filestat_get(){return{ret:0,filestat:new P(M,BigInt(0))}}fd_fdstat_get(){const e=new B(M,0);return e.fs_rights_base=BigInt(64),{ret:0,fdstat:e}}fd_write(e,r){let s=0;for(const i of r){const t=e.slice(i.buf,i.buf+i.buf_len);this.write(t),s+=i.buf_len}return{ret:0,nwritten:s}}static lineBuffered(e){const r=new TextDecoder("utf-8",{fatal:!1});let s="";return new Q(i=>{s+=r.decode(i,{stream:!0});const t=s.split(`
`);for(const[n,o]of t.entries())n<t.length-1?e(o):s=o})}constructor(e){super(),this.write=e}}let k=new DataView(new ArrayBuffer);function _(c){return k.buffer!==c.buffer&&(k=new DataView(c.buffer)),k}function _e(c){return c>>>0}const E=new TextDecoder("utf-8"),be=new TextEncoder("utf-8");function O(c,e,r){if(typeof c!="string")throw new TypeError("expected a string");if(c.length===0)return R=0,1;let s=0,i=0,t=0;for(;c.length>0;){i=e(i,s,1,s+c.length),s+=c.length;const{read:n,written:o}=be.encodeInto(c,new Uint8Array(r.buffer,i+t,s-t));t+=o,c=c.slice(n)}return s>t&&(i=e(i,s,1,t)),R=t,i}let R=0;class V{constructor(){this.list=[],this.head=0}insert(e){this.head>=this.list.length&&this.list.push({next:this.list.length+1,val:void 0});const r=this.head,s=this.list[r];return this.head=s.next,s.next=-1,s.val=e,r}get(e){if(e>=this.list.length)throw new RangeError("handle index not valid");const r=this.list[e];if(r.next===-1)return r.val;throw new RangeError("handle index not valid")}remove(e){const r=this.get(e),s=this.list[e];return s.val=void 0,s.next=this.head,this.head=e,r}}function j(){throw new RangeError("invalid variant discriminant for bool")}class W{constructor(){this._resource0_slab=new V,this._resource1_slab=new V}addToImports(e){"canonical_abi"in e||(e.canonical_abi={}),e.canonical_abi["resource_drop_rb-iseq"]=r=>{this._resource0_slab.remove(r).drop()},e.canonical_abi["resource_clone_rb-iseq"]=r=>{const s=this._resource0_slab.get(r);return this._resource0_slab.insert(s.clone())},e.canonical_abi["resource_get_rb-iseq"]=r=>this._resource0_slab.get(r)._wasm_val,e.canonical_abi["resource_new_rb-iseq"]=r=>(this._registry0,this._resource0_slab.insert(new ge(r,this))),e.canonical_abi["resource_drop_rb-abi-value"]=r=>{this._resource1_slab.remove(r).drop()},e.canonical_abi["resource_clone_rb-abi-value"]=r=>{const s=this._resource1_slab.get(r);return this._resource1_slab.insert(s.clone())},e.canonical_abi["resource_get_rb-abi-value"]=r=>this._resource1_slab.get(r)._wasm_val,e.canonical_abi["resource_new_rb-abi-value"]=r=>(this._registry1,this._resource1_slab.insert(new T(r,this)))}async instantiate(e,r){if(r=r||{},this.addToImports(r),e instanceof WebAssembly.Instance)this.instance=e;else if(e instanceof WebAssembly.Module)this.instance=await WebAssembly.instantiate(e,r);else if(e instanceof ArrayBuffer||e instanceof Uint8Array){const{instance:s}=await WebAssembly.instantiate(e,r);this.instance=s}else{const{instance:s}=await WebAssembly.instantiateStreaming(e,r);this.instance=s}this._exports=this.instance.exports,this._registry0=new FinalizationRegistry(this._exports["canonical_abi_drop_rb-iseq"]),this._registry1=new FinalizationRegistry(this._exports["canonical_abi_drop_rb-abi-value"])}rubyShowVersion(){this._exports["ruby-show-version: func() -> ()"]()}rubyInit(){this._exports["ruby-init: func() -> ()"]()}rubySysinit(e){const r=this._exports.memory,s=this._exports.cabi_realloc,i=e,t=i.length,n=s(0,0,4,t*8);for(let o=0;o<i.length;o++){const a=i[o],l=n+o*8,u=O(a,s,r),f=R;_(r).setInt32(l+4,f,!0),_(r).setInt32(l+0,u,!0)}this._exports["ruby-sysinit: func(args: list<string>) -> ()"](n,t)}rubyOptions(e){const r=this._exports.memory,s=this._exports.cabi_realloc,i=e,t=i.length,n=s(0,0,4,t*8);for(let a=0;a<i.length;a++){const l=i[a],u=n+a*8,f=O(l,s,r),h=R;_(r).setInt32(u+4,h,!0),_(r).setInt32(u+0,f,!0)}const o=this._exports["ruby-options: func(args: list<string>) -> handle<rb-iseq>"](n,t);return this._resource0_slab.remove(o)}rubyScript(e){const r=this._exports.memory,s=this._exports.cabi_realloc,i=O(e,s,r),t=R;this._exports["ruby-script: func(name: string) -> ()"](i,t)}rubyInitLoadpath(){this._exports["ruby-init-loadpath: func() -> ()"]()}rbEvalStringProtect(e){const r=this._exports.memory,s=this._exports.cabi_realloc,i=O(e,s,r),t=R,n=this._exports["rb-eval-string-protect: func(str: string) -> tuple<handle<rb-abi-value>, s32>"](i,t);return[this._resource1_slab.remove(_(r).getInt32(n+0,!0)),_(r).getInt32(n+4,!0)]}rbFuncallvProtect(e,r,s){const i=this._exports.memory,t=this._exports.cabi_realloc,n=e;if(!(n instanceof T))throw new TypeError("expected instance of RbAbiValue");const o=s,a=o.length,l=t(0,0,4,a*4);for(let f=0;f<o.length;f++){const h=o[f],d=l+f*4,b=h;if(!(b instanceof T))throw new TypeError("expected instance of RbAbiValue");_(i).setInt32(d+0,this._resource1_slab.insert(b.clone()),!0)}const u=this._exports["rb-funcallv-protect: func(recv: handle<rb-abi-value>, mid: u32, args: list<handle<rb-abi-value>>) -> tuple<handle<rb-abi-value>, s32>"](this._resource1_slab.insert(n.clone()),_e(r),l,a);return[this._resource1_slab.remove(_(i).getInt32(u+0,!0)),_(i).getInt32(u+4,!0)]}rbIntern(e){const r=this._exports.memory,s=this._exports.cabi_realloc,i=O(e,s,r),t=R;return this._exports["rb-intern: func(name: string) -> u32"](i,t)>>>0}rbErrinfo(){const e=this._exports["rb-errinfo: func() -> handle<rb-abi-value>"]();return this._resource1_slab.remove(e)}rbClearErrinfo(){this._exports["rb-clear-errinfo: func() -> ()"]()}rstringPtr(e){const r=this._exports.memory,s=e;if(!(s instanceof T))throw new TypeError("expected instance of RbAbiValue");const i=this._exports["rstring-ptr: func(value: handle<rb-abi-value>) -> string"](this._resource1_slab.insert(s.clone())),t=_(r).getInt32(i+0,!0),n=_(r).getInt32(i+4,!0),o=E.decode(new Uint8Array(r.buffer,t,n));return this._exports["cabi_post_rstring-ptr"](i),o}rbVmBugreport(){this._exports["rb-vm-bugreport: func() -> ()"]()}rbGcEnable(){const r=this._exports["rb-gc-enable: func() -> bool"]();return r==0?!1:r==1?!0:j()}rbGcDisable(){const r=this._exports["rb-gc-disable: func() -> bool"]();return r==0?!1:r==1?!0:j()}rbSetShouldProhibitRewind(e){const s=this._exports["rb-set-should-prohibit-rewind: func(new-value: bool) -> bool"](e?1:0);return s==0?!1:s==1?!0:j()}}class ge{constructor(e,r){this._wasm_val=e,this._obj=r,this._refcnt=1,r._registry0.register(this,e,this)}clone(){return this._refcnt+=1,this}drop(){if(this._refcnt-=1,this._refcnt!==0)return;this._obj._registry0.unregister(this);const e=this._obj._exports["canonical_abi_drop_rb-iseq"],r=this._wasm_val;delete this._obj,delete this._refcnt,delete this._wasm_val,e(r)}}class T{constructor(e,r){this._wasm_val=e,this._obj=r,this._refcnt=1,r._registry1.register(this,e,this)}clone(){return this._refcnt+=1,this}drop(){if(this._refcnt-=1,this._refcnt!==0)return;this._obj._registry1.unregister(this);const e=this._obj._exports["canonical_abi_drop_rb-abi-value"],r=this._wasm_val;delete this._obj,delete this._refcnt,delete this._wasm_val,e(r)}}function pe(c,e,r){"rb-js-abi-host"in c||(c["rb-js-abi-host"]={}),c["rb-js-abi-host"]["eval-js: func(code: string) -> variant { success(handle<js-abi-value>), failure(handle<js-abi-value>) }"]=function(i,t,n){const o=r("memory"),a=i,l=t,u=E.decode(new Uint8Array(o.buffer,a,l)),h=e.evalJs(u);switch(h.tag){case"success":{const d=h.val;_(o).setInt8(n+0,0,!0),_(o).setInt32(n+4,s.insert(d),!0);break}case"failure":{const d=h.val;_(o).setInt8(n+0,1,!0),_(o).setInt32(n+4,s.insert(d),!0);break}default:throw new RangeError("invalid variant specified for JsAbiResult")}},c["rb-js-abi-host"]["is-js: func(value: handle<js-abi-value>) -> bool"]=function(i){return e.isJs(s.get(i))?1:0},c["rb-js-abi-host"]["instance-of: func(value: handle<js-abi-value>, klass: handle<js-abi-value>) -> bool"]=function(i,t){return e.instanceOf(s.get(i),s.get(t))?1:0},c["rb-js-abi-host"]["global-this: func() -> handle<js-abi-value>"]=function(){const i=e.globalThis();return s.insert(i)},c["rb-js-abi-host"]["int-to-js-number: func(value: s32) -> handle<js-abi-value>"]=function(i){const t=e.intToJsNumber(i);return s.insert(t)},c["rb-js-abi-host"]["float-to-js-number: func(value: float64) -> handle<js-abi-value>"]=function(i){const t=e.floatToJsNumber(i);return s.insert(t)},c["rb-js-abi-host"]["string-to-js-string: func(value: string) -> handle<js-abi-value>"]=function(i,t){const n=r("memory"),o=i,a=t,l=E.decode(new Uint8Array(n.buffer,o,a)),u=e.stringToJsString(l);return s.insert(u)},c["rb-js-abi-host"]["bool-to-js-bool: func(value: bool) -> handle<js-abi-value>"]=function(i){const t=i,n=e.boolToJsBool(t==0?!1:t==1?!0:j());return s.insert(n)},c["rb-js-abi-host"]["proc-to-js-function: func(value: u32) -> handle<js-abi-value>"]=function(i){const t=e.procToJsFunction(i>>>0);return s.insert(t)},c["rb-js-abi-host"]["rb-object-to-js-rb-value: func(raw-rb-abi-value: u32) -> handle<js-abi-value>"]=function(i){const t=e.rbObjectToJsRbValue(i>>>0);return s.insert(t)},c["rb-js-abi-host"]["js-value-to-string: func(value: handle<js-abi-value>) -> string"]=function(i,t){const n=r("memory"),o=r("cabi_realloc"),a=e.jsValueToString(s.get(i)),l=O(a,o,n),u=R;_(n).setInt32(t+4,u,!0),_(n).setInt32(t+0,l,!0)},c["rb-js-abi-host"]["js-value-to-integer: func(value: handle<js-abi-value>) -> variant { f64(float64), bignum(string) }"]=function(i,t){const n=r("memory"),o=r("cabi_realloc"),l=e.jsValueToInteger(s.get(i));switch(l.tag){case"f64":{const u=l.val;_(n).setInt8(t+0,0,!0),_(n).setFloat64(t+8,+u,!0);break}case"bignum":{const u=l.val;_(n).setInt8(t+0,1,!0);const f=O(u,o,n),h=R;_(n).setInt32(t+12,h,!0),_(n).setInt32(t+8,f,!0);break}default:throw new RangeError("invalid variant specified for RawInteger")}},c["rb-js-abi-host"]["export-js-value-to-host: func(value: handle<js-abi-value>) -> ()"]=function(i){e.exportJsValueToHost(s.get(i))},c["rb-js-abi-host"]["import-js-value-from-host: func() -> handle<js-abi-value>"]=function(){const i=e.importJsValueFromHost();return s.insert(i)},c["rb-js-abi-host"]["js-value-typeof: func(value: handle<js-abi-value>) -> string"]=function(i,t){const n=r("memory"),o=r("cabi_realloc"),a=e.jsValueTypeof(s.get(i)),l=O(a,o,n),u=R;_(n).setInt32(t+4,u,!0),_(n).setInt32(t+0,l,!0)},c["rb-js-abi-host"]["js-value-equal: func(lhs: handle<js-abi-value>, rhs: handle<js-abi-value>) -> bool"]=function(i,t){return e.jsValueEqual(s.get(i),s.get(t))?1:0},c["rb-js-abi-host"]["js-value-strictly-equal: func(lhs: handle<js-abi-value>, rhs: handle<js-abi-value>) -> bool"]=function(i,t){return e.jsValueStrictlyEqual(s.get(i),s.get(t))?1:0},c["rb-js-abi-host"]["reflect-apply: func(target: handle<js-abi-value>, this-argument: handle<js-abi-value>, arguments: list<handle<js-abi-value>>) -> variant { success(handle<js-abi-value>), failure(handle<js-abi-value>) }"]=function(i,t,n,o,a){const l=r("memory"),u=o,f=n,h=[];for(let g=0;g<u;g++){const m=f+g*4;h.push(s.get(_(l).getInt32(m+0,!0)))}const b=e.reflectApply(s.get(i),s.get(t),h);switch(b.tag){case"success":{const g=b.val;_(l).setInt8(a+0,0,!0),_(l).setInt32(a+4,s.insert(g),!0);break}case"failure":{const g=b.val;_(l).setInt8(a+0,1,!0),_(l).setInt32(a+4,s.insert(g),!0);break}default:throw new RangeError("invalid variant specified for JsAbiResult")}},c["rb-js-abi-host"]["reflect-construct: func(target: handle<js-abi-value>, arguments: list<handle<js-abi-value>>) -> handle<js-abi-value>"]=function(i,t,n){const o=r("memory"),a=n,l=t,u=[];for(let h=0;h<a;h++){const d=l+h*4;u.push(s.get(_(o).getInt32(d+0,!0)))}const f=e.reflectConstruct(s.get(i),u);return s.insert(f)},c["rb-js-abi-host"]["reflect-delete-property: func(target: handle<js-abi-value>, property-key: string) -> bool"]=function(i,t,n){const o=r("memory"),a=t,l=n,u=E.decode(new Uint8Array(o.buffer,a,l));return e.reflectDeleteProperty(s.get(i),u)?1:0},c["rb-js-abi-host"]["reflect-get: func(target: handle<js-abi-value>, property-key: string) -> variant { success(handle<js-abi-value>), failure(handle<js-abi-value>) }"]=function(i,t,n,o){const a=r("memory"),l=t,u=n,f=E.decode(new Uint8Array(a.buffer,l,u)),d=e.reflectGet(s.get(i),f);switch(d.tag){case"success":{const b=d.val;_(a).setInt8(o+0,0,!0),_(a).setInt32(o+4,s.insert(b),!0);break}case"failure":{const b=d.val;_(a).setInt8(o+0,1,!0),_(a).setInt32(o+4,s.insert(b),!0);break}default:throw new RangeError("invalid variant specified for JsAbiResult")}},c["rb-js-abi-host"]["reflect-get-own-property-descriptor: func(target: handle<js-abi-value>, property-key: string) -> handle<js-abi-value>"]=function(i,t,n){const o=r("memory"),a=t,l=n,u=E.decode(new Uint8Array(o.buffer,a,l)),f=e.reflectGetOwnPropertyDescriptor(s.get(i),u);return s.insert(f)},c["rb-js-abi-host"]["reflect-get-prototype-of: func(target: handle<js-abi-value>) -> handle<js-abi-value>"]=function(i){const t=e.reflectGetPrototypeOf(s.get(i));return s.insert(t)},c["rb-js-abi-host"]["reflect-has: func(target: handle<js-abi-value>, property-key: string) -> bool"]=function(i,t,n){const o=r("memory"),a=t,l=n,u=E.decode(new Uint8Array(o.buffer,a,l));return e.reflectHas(s.get(i),u)?1:0},c["rb-js-abi-host"]["reflect-is-extensible: func(target: handle<js-abi-value>) -> bool"]=function(i){return e.reflectIsExtensible(s.get(i))?1:0},c["rb-js-abi-host"]["reflect-own-keys: func(target: handle<js-abi-value>) -> list<handle<js-abi-value>>"]=function(i,t){const n=r("memory"),o=r("cabi_realloc"),l=e.reflectOwnKeys(s.get(i)),u=l.length,f=o(0,0,4,u*4);for(let h=0;h<l.length;h++){const d=l[h],b=f+h*4;_(n).setInt32(b+0,s.insert(d),!0)}_(n).setInt32(t+4,u,!0),_(n).setInt32(t+0,f,!0)},c["rb-js-abi-host"]["reflect-prevent-extensions: func(target: handle<js-abi-value>) -> bool"]=function(i){return e.reflectPreventExtensions(s.get(i))?1:0},c["rb-js-abi-host"]["reflect-set: func(target: handle<js-abi-value>, property-key: string, value: handle<js-abi-value>) -> variant { success(handle<js-abi-value>), failure(handle<js-abi-value>) }"]=function(i,t,n,o,a){const l=r("memory"),u=t,f=n,h=E.decode(new Uint8Array(l.buffer,u,f)),b=e.reflectSet(s.get(i),h,s.get(o));switch(b.tag){case"success":{const g=b.val;_(l).setInt8(a+0,0,!0),_(l).setInt32(a+4,s.insert(g),!0);break}case"failure":{const g=b.val;_(l).setInt8(a+0,1,!0),_(l).setInt32(a+4,s.insert(g),!0);break}default:throw new RangeError("invalid variant specified for JsAbiResult")}},c["rb-js-abi-host"]["reflect-set-prototype-of: func(target: handle<js-abi-value>, prototype: handle<js-abi-value>) -> bool"]=function(i,t){return e.reflectSetPrototypeOf(s.get(i),s.get(t))?1:0},"canonical_abi"in c||(c.canonical_abi={});const s=new V;c.canonical_abi["resource_drop_js-abi-value"]=i=>{const t=s.remove(i);e.dropJsAbiValue&&e.dropJsAbiValue(t)}}class Te{constructor(){this.instance=null,this.interfaceState={hasJSFrameAfterRbFrame:!1};const e=r=>{const s=["addToImports","instantiate","rbSetShouldProhibitRewind","rbGcDisable","rbGcEnable"],i=["constructor"].concat(s);for(const t of Object.getOwnPropertyNames(W.prototype)){if(i.includes(t))continue;const n=r[t];typeof n=="function"&&(r[t]=(...o)=>{if(this.interfaceState.hasJSFrameAfterRbFrame){const l=this.guest.rbSetShouldProhibitRewind(!0),u=this.guest.rbGcDisable(),f=Reflect.apply(n,r,o);return this.guest.rbSetShouldProhibitRewind(l),u||this.guest.rbGcEnable(),f}else return Reflect.apply(n,r,o)})}return r};this.guest=e(new W),this.transport=new we,this.exceptionFormatter=new ye}initialize(e=["ruby.wasm","-EUTF-8","-e_=0"]){const r=e.map(s=>s+"\0");this.guest.rubyInit(),this.guest.rubySysinit(r),this.guest.rubyOptions(r),this.eval('require "/bundle/setup"')}async setInstance(e){this.instance=e,await this.guest.instantiate(e)}addToImports(e){this.guest.addToImports(e);function r(i){return(...t)=>{try{return{tag:"success",val:i(...t)}}catch(n){if(n instanceof K)throw n;return{tag:"failure",val:n}}}}e["rb-js-abi-host"]={rb_wasm_throw_prohibit_rewind_exception:(i,t)=>{const n=this.instance.exports.memory,o=new TextDecoder().decode(new Uint8Array(n.buffer,i,t));throw new K(`Ruby APIs that may rewind the VM stack are prohibited under nested VM operation (${o})
Nested VM operation means that the call stack has sandwitched JS frames like JS -> Ruby -> JS -> Ruby caused by something like \`window.rubyVM.eval("JS.global[:rubyVM].eval('Fiber.yield')")\`

Please check your call stack and make sure that you are **not** doing any of the following inside the nested Ruby frame:
  1. Switching fibers (e.g. Fiber#resume, Fiber.yield, and Fiber#transfer)
     Note that \`evalAsync\` JS API switches fibers internally
  2. Raising uncaught exceptions
     Please catch all exceptions inside the nested operation
  3. Calling Continuation APIs
`)}},pe(e,(i=>{for(const[t,n]of Object.entries(i))typeof n=="function"&&(i[t]=(...o)=>{const a=this.interfaceState.hasJSFrameAfterRbFrame;this.interfaceState.hasJSFrameAfterRbFrame=!0;const l=Reflect.apply(n,i,o);return this.interfaceState.hasJSFrameAfterRbFrame=a,l});return i})({evalJs:r(i=>Function(i)()),isJs:i=>!0,globalThis:()=>{if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;throw new Error("unable to locate global object")},intToJsNumber:i=>i,floatToJsNumber:i=>i,stringToJsString:i=>i,boolToJsBool:i=>i,procToJsFunction:i=>{const t=this.rbValueOfPointer(i);return(...n)=>{t.call("call",...n.map(o=>this.wrap(o)))}},rbObjectToJsRbValue:i=>this.rbValueOfPointer(i),jsValueToString:i=>String(i),jsValueToInteger(i){return typeof i=="number"?{tag:"f64",val:i}:typeof i=="bigint"?{tag:"bignum",val:BigInt(i).toString(10)+"\0"}:typeof i=="string"?{tag:"bignum",val:i+"\0"}:typeof i>"u"?{tag:"f64",val:0}:{tag:"f64",val:Number(i)}},exportJsValueToHost:i=>{this.transport.takeJsValue(i)},importJsValueFromHost:()=>this.transport.consumeJsValue(),instanceOf:(i,t)=>typeof t=="function"?i instanceof t:!1,jsValueTypeof(i){return typeof i},jsValueEqual(i,t){return i==t},jsValueStrictlyEqual(i,t){return i===t},reflectApply:r((i,t,n)=>Reflect.apply(i,t,n)),reflectConstruct:function(i,t){throw new Error("Function not implemented.")},reflectDeleteProperty:function(i,t){throw new Error("Function not implemented.")},reflectGet:r((i,t)=>i[t]),reflectGetOwnPropertyDescriptor:function(i,t){throw new Error("Function not implemented.")},reflectGetPrototypeOf:function(i){throw new Error("Function not implemented.")},reflectHas:function(i,t){throw new Error("Function not implemented.")},reflectIsExtensible:function(i){throw new Error("Function not implemented.")},reflectOwnKeys:function(i){throw new Error("Function not implemented.")},reflectPreventExtensions:function(i){throw new Error("Function not implemented.")},reflectSet:r((i,t,n)=>Reflect.set(i,t,n)),reflectSetPrototypeOf:function(i,t){throw new Error("Function not implemented.")}}),i=>this.instance.exports[i])}printVersion(){this.guest.rubyShowVersion()}eval(e){return D(this,this.privateObject(),e)}evalAsync(e){const r=this.eval("require 'js'; JS");return te(this,this.privateObject(),s=>{r.call("__eval_async_rb",this.wrap(e),s)})}wrap(e){return this.transport.importJsValue(e,this)}privateObject(){return{transport:this.transport,exceptionFormatter:this.exceptionFormatter}}rbValueOfPointer(e){const r=new T(e,this.guest);return new A(r,this,this.privateObject())}}class we{constructor(){this._takenJsValue=null}takeJsValue(e){this._takenJsValue=e}consumeJsValue(){return this._takenJsValue}exportJsValue(e){return e.call("__export_to_js"),this._takenJsValue}importJsValue(e,r){return this._takenJsValue=e,r.eval('require "js"; JS::Object').call("__import_from_js")}}class A{constructor(e,r,s){this.inner=e,this.vm=r,this.privateObject=s}call(e,...r){const s=r.map(i=>i.inner);return new A(H(this.vm,this.privateObject,this.inner,e,s),this.vm,this.privateObject)}callAsync(e,...r){const s=this.vm.eval("require 'js'; JS");return te(this.vm,this.privateObject,i=>{s.call("__call_async_method",this,this.vm.wrap(e),i,...r)})}[Symbol.toPrimitive](e){return e==="string"||e==="default"?this.toString():null}toString(){const e=H(this.vm,this.privateObject,this.inner,"to_s",[]);return this.vm.guest.rstringPtr(e)}toJS(){const r=this.vm.eval("JS").call("try_convert",this);return r.call("nil?").toString()==="true"?null:this.privateObject.transport.exportJsValue(r)}}var y;(function(c){c[c.None=0]="None",c[c.Return=1]="Return",c[c.Break=2]="Break",c[c.Next=3]="Next",c[c.Retry=4]="Retry",c[c.Redo=5]="Redo",c[c.Raise=6]="Raise",c[c.Throw=7]="Throw",c[c.Fatal=8]="Fatal",c[c.Mask=15]="Mask"})(y||(y={}));class ye{constructor(){this.literalsCache=null,this.isFormmatting=!1}format(e,r,s){class i extends Error{}if(this.isFormmatting)throw new i("Unexpected exception occurred during formatting exception message");this.isFormmatting=!0;try{return this._format(e,r,s)}finally{this.isFormmatting=!1}}_format(e,r,s){const[i,t,n]=(()=>{if(this.literalsCache==null){const u=[D(r,s,"0"),D(r,s,"1"),D(r,s,`"
"`)];return this.literalsCache=u,u}else return this.literalsCache})();let o,a,l;try{o=e.call("class").toString()}catch{o="unknown"}try{l=e.toString()}catch{l="unknown"}try{a=e.call("backtrace")}catch{return this.formatString(o,l)}if(a.call("nil?").toString()==="true")return this.formatString(o,l);try{const u=a.call("at",i),f=a.call("drop",t).call("join",n);return this.formatString(o,l,[u.toString(),f.toString()])}catch{return this.formatString(o,l)}}formatString(e,r,s){return s?`${s[0]}: ${r} (${e})
${s[1]}`:`${e}: ${r}`}}const Z=(c,e,r)=>{switch(c&y.Mask){case y.None:break;case y.Return:throw new w("unexpected return");case y.Next:throw new w("unexpected next");case y.Break:throw new w("unexpected break");case y.Redo:throw new w("unexpected redo");case y.Retry:throw new w("retry outside of rescue clause");case y.Throw:throw new w("unexpected throw");case y.Raise:case y.Fatal:const s=new A(e.guest.rbErrinfo(),e,r);throw s.call("nil?").toString()==="true"?new w("no exception object"):(e.guest.rbClearErrinfo(),new w(r.exceptionFormatter.format(s,e,r)));default:throw new w(`unknown error tag: ${c}`)}};function ee(c,e){try{return e()}catch(r){if(r instanceof w)throw r;if(c.guest.rbVmBugreport(),r instanceof WebAssembly.RuntimeError&&r.message==="unreachable"){const s=new w(`Something went wrong in Ruby VM: ${r}`);throw s.stack=r.stack,s}else throw r}}const H=(c,e,r,s,i)=>{const t=c.guest.rbIntern(s+"\0");return ee(c,()=>{const[n,o]=c.guest.rbFuncallvProtect(r,t,i);return Z(o,c,e),n})},D=(c,e,r)=>ee(c,()=>{const[s,i]=c.guest.rbEvalStringProtect(r+"\0");return Z(i,c,e),new A(s,c,e)});function te(c,e,r){return new Promise((s,i)=>{const t=c.wrap({resolve:s,reject:n=>{const o=new w(e.exceptionFormatter.format(n,c,e));i(o)}});r(t)})}class w extends Error{constructor(e){super(e)}}class K extends w{constructor(e){super("Ruby Fatal Error: "+e)}}export{Q as C,v as D,me as E,de as F,X as O,Se as P,Te as R,Ne as W,Re as a,Oe as b,Ee as c,he as d};
